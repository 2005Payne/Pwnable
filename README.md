# Pwnable (드림핵을 배운 내용을 정리하였습니다)


## 리눅스 메모리구조   
__시스템해킹__ 의 많은 공격은 __메모리 오염__ 을 이용하여 공격합니다.   
그렇기 때문에 메모리구조를 알아야 합니다.   
리눅스에는 5가지 구역으로 나눈 것을 __세그먼트__ 라고 합니다.   
__코드 세그먼트__ , __데이터 세그먼트__ , __BSS 세그먼트__ , __힙 세그먼트__ , __스택 세그먼트__ 가 있습니다.    
이렇게 5가지의 구역을 나누면 필요한 읽기/쓰기/실행 권한을 적절하게 부여할 수 있습니다.    
권한을 부여하면 cpu는 권한이 없는 행동을 할 수 없습니다.
    
__코드 세그먼트__   
실행 가능한 기계코드가 위치하는 곳 입니다.   
읽기 권한과 실행 권한이 있습니다. 

__데이터 세그먼트__   
값이 정해진 전역 변수와 정적 변수 , 상수 등등.. 이 위치합니다.   
rodata와 data세그먼트가 존재하는데   
두 차이점은 rodata는 쓰기 권한이 없고   
data세그먼트는 쓰기권한이 있습니다.   

__BSS 세그먼트__   
초기화 되지 않은 전역 변수가 위치합니다.
(선언만 하고 초기화 하지 않은 전역변수)
이 구역의 초기화 되지 않은 전역 변수의 값은 0이 됩니다.    
읽기 권한과 쓰기 권한이 부여됩니다.   

__스택 세그먼트__   
인자,지역변수 등등... 이 위치합니다.   
프로세스의 스택이 위치합니다.   
읽기와 쓰기 권한이 부여됩니다.   

__힘 세그먼트__   
힙 데이터가 위치합니다.   
c언어의 malloc()와 같이 호출해서 할당받는 메모리가 위치합니다.   
읽기와 쓰기권한이 부여됩니다.   

## x86-64 아키텍처
64비트 아키텍처와 32비트 아키텍처에서 이름에 붙어있는 숫자들은   
컴퓨터가 한번에 처리할 수 있는 데이터 크기 입니다. 이를 word 라고 부릅니다.   

__범용 레지스터__   
자유롭게 사용하다가 필요할 때 그 용도로 사용하는 레지스터입니다.   
rax:함수의 반환값   
rbx:x64에서 주 용도 없음   
rcx:for문의 i 같은 존재   
rdx:x64에서 주 용도 없음   
rsi:데이터를 옮길 때 원본을 가리키는 포인터   
rdi:데이터를 옭길 때 목적지를 가리키는 포인터   
rsp:사용중인 스택의 위치를 가리키는 포인터   
rbp:스택의 바닥을 가리키는 포인터   
그 외:r8~r9   
   
__세그먼트 레지스터__   
현대 아키텍처는 코드 영역과 데이터, 스택 메모리 영역을 가리킬 때 사용됨   
나머지는 운영체제별로 다릅니다. 범용적인 용도로 제작된 세그먼트 레지스터   

__rip(명령어 포인터 레지스터)__   
어느 부분의 코드를 실행할지 가리킵니다.   

__플래그 레지스터__   
여러가지 플래그 레지스터들로   
cpu의 현재 상태를 0과 1로 표시합니다.   
CF:부호 없는 수의 연산결과가 비트 범위를 넘을경우   
ZF:연산의 결과가 0일 경우 설정 됩니다.   
SF:연산의 결과가 음수일 경우 설정됩니다.   
OF:부호 있는 수의 연산 결과가 비트 범위를 넘을 경우 설정 됩니다.   

__x86-64 어셈블리어 문법 구조__     
opcode(명령어) operand1(피연산자1) , operand2(피연산자2)  
   
__명령어(opcode)__   
mov (operand1) 에 (operand2) 값을 복사
lea (operand1) 에 (operand2) 가르키는 주소에 값을 복사
inc 
dec
add
sub
and
or
xor
not
cmp
test
   
__피연산자(operand)__
피연산자는 메모리,레지스터,상수 가 있습니다.   
   
메모리 피연산자 문법 구조는   
(데이터크기) [ (주소) ] 로 이루어 집니다.
주소를 쓸 때는 [] 안에 써야하고   
데이터 크기는   
QWORD PTR(8바이트)   
DWORD PTR(4바이트)   
WODR PTR(2바이트)   
BYTE PTR(1바이트)
